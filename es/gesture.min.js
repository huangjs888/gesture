class t{constructor(){this.events={},this.events={}}one(t,e,i){const n="function"==typeof e?(...s)=>{e.apply(null,s),this.off(t,n,i)}:e;this.on(t,n,i)}on(t,e,i){const n=this.events[t]||{pool:[],single:-1};if("function"==typeof e)if(i)-1===n.single?n.single=n.pool.push(e)-1:n.pool[n.single]=e;else{let t=!0;for(let i=0,s=n.pool.length;s>i;i++)if(n.pool[i]===e&&i!==n.single){t=!1;break}t&&n.pool.push(e)}else i&&-1!==n.single&&(n.pool.splice(n.single,1),n.single=-1);this.events[t]=n}off(t,e,i){if(void 0===t)this.events={};else if(void 0===e)delete this.events[t];else if(i){const e=this.events[t];e&&-1!==e.single&&(e.pool.splice(e.single,1),e.single=-1)}else{const i=this.events[t];if(i)for(let t=i.pool.length-1;t>=0;t--)if(i.pool[t]===e&&t!==i.single){i.pool.splice(t,1);break}}}emit(t,e){const i=this.events[t];if(i)for(let n=0,s=i.pool.length;s>n;n++){const s=i.pool[n];if("function"==typeof s){if(!1===s.call(null,e,t))break}}}}const e=(t,e)=>{let i=t;for(;i&&i!==e;)i=i.parentNode;return!!i};function i(t,e,i){return"number"!=typeof t||i>t?e:t}function n(){return window.navigator.maxTouchPoints||"ontouchstart"in window.document}function s(t,i=!1){if(t.touches){if(i){const i=Array.prototype.filter.call(t.touches,(i=>e(i.target,t.currentTarget))).map((t=>({pageX:t.pageX,pageY:t.pageY,identifier:t.identifier})));return{points:i,isFirst:t.changedTouches.length===i.length}}return{points:Array.prototype.slice.call(t.changedTouches||[]).map((t=>({pageX:t.pageX,pageY:t.pageY,identifier:t.identifier})))}}return{points:[{pageX:t.pageX,pageY:t.pageY,identifier:-1}],isFirst:i}}function o([t,e],[i,n]){return"number"==typeof t&&"number"==typeof i&&"number"==typeof e&&"number"==typeof n?Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2)):0}function r([t,e],[i,n]){return"number"==typeof t&&"number"==typeof i&&"number"==typeof e&&"number"==typeof n?180*Math.atan2(n-e,i-t)/Math.PI:0}function p([t,e],[i,n]){const s="number"==typeof t&&"number"==typeof e,o="number"==typeof i&&"number"==typeof n;return s||o?s&&!o?[t,e]:!s&&o?[i,n]:[(t+i)/2,(e+n)/2]:[0,0]}function a([t,e],[i,n]){if("number"==typeof t&&"number"==typeof i&&"number"==typeof e&&"number"==typeof n){const s=t-i,o=e-n;if(s!==o)return Math.abs(o)>Math.abs(s)?e-n>0?"Up":"Down":t-i>0?"Left":"Right"}return"None"}let h=class extends t{constructor(t){super(),this.wheelDelay=350,this.longTapInterval=750,this.doubleTapInterval=250,this.doubleTapDistance=30,this.touchMoveDistance=3,this.swipeVelocity=.3,this.swipeDuration=100,this.raiseDuration=100,this._rotateAngle=0,this._noMouseTimer=0,this._singleTapTimer=0,this._longTapTimer=0,this._wheelTimerEnd=null,this._preventTap=!0,this._swipePoints=null,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._firstPointer=null,this._pointer0=null,this._pointer1=null,this.resetOptions(t)}resetOptions(t){const{wheelDelay:e,longTapInterval:n,doubleTapInterval:s,doubleTapDistance:o,touchMoveDistance:r,swipeVelocity:p,swipeDuration:a,raiseDuration:h}=t||{};this.wheelDelay=i(e,350,1),this.longTapInterval=i(n,750,1),this.doubleTapInterval=i(s,250,1),this.doubleTapDistance=i(o,30,1),this.touchMoveDistance=i(r,3,0),this.swipeVelocity=i(p,.3,0),this.swipeDuration=i(a,100,1),this.raiseDuration=i(h,100,1)}preventAllTap(t=!0){this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,t&&(this._firstPointer=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0)}};function l(){this.nativeEvent||(this.preventDefault?this.preventDefault():this.returnValue=!1)}function u(){this.stopPropagation?this.stopPropagation():this.cancelBubble=!0}function c(){this.nativeEvent?this.nativeEvent.stopImmediatePropagation&&this.nativeEvent.stopImmediatePropagation():this.stopImmediatePropagation?this.stopImmediatePropagation():u.call(this)}function m(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!n()&&!!t.touches,preventDefault:l.bind(t),stopPropagation:u.bind(t),stopImmediatePropagation:c.bind(t)},{points:i,isFirst:r}=s(t,!0);r?(this._wheelTimerEnd&&(clearTimeout(this._wheelTimerEnd.timer),this._wheelTimerEnd.wheelEnd(),this._wheelTimerEnd=null),this._pointer0=null,this._pointer1=null):(this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1));for(let t=0,e=i.length;e>t;++t){const e=i[t],n=[e.pageX,e.pageY],s={start:n,previous:n,current:n,identifier:e.identifier,changed:!0};this._pointer0?this._pointer1||this._pointer0.identifier===e.identifier||(this._pointer1=s):this._pointer0=s}this.preventAllTap(!1),this._swipePoints=null,this._rotateAngle=0;const a=this._pointer0,h=this._pointer1;if(h&&a)this._firstPointer=null,e.pointers=[a,h],e.getPoint=()=>p(a.current,h.current),this.emit("gestureStart",e);else{if(!a)return;{e.pointers=[a],e.getPoint=()=>a.current,this._preventTap=!1,this._longTapTimer=+setTimeout((()=>{this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._longTapTimer=0,this._firstPointer=null,e.waitTime=this.longTapInterval,this.emit("longTap",e)}),this.longTapInterval);const t=this._firstPointer,i=this._singleTapTimer;i&&t&&o(t.current,a.current)<this.doubleTapDistance?(clearTimeout(i),this._singleTapTimer=0,this._preventSingleTap=!0,this._preventDoubleTap=!1,e.getPoint=()=>t.current):(this._firstPointer=a,this._preventSingleTap=!1,this._preventDoubleTap=!0)}}this.emit("pointerStart",e)}function d(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!n()&&!!t.touches,preventDefault:l.bind(t),stopPropagation:u.bind(t),stopImmediatePropagation:c.bind(t)};this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:i}=s(t);for(let t=0,e=i.length;e>t;++t){const e=i[t],n=[e.pageX,e.pageY];this._pointer0&&this._pointer0.identifier===e.identifier?(this._pointer0.changed=!0,this._pointer0.previous=this._pointer0.current,this._pointer0.current=n):this._pointer1&&this._pointer1.identifier===e.identifier&&(this._pointer1.changed=!0,this._pointer1.previous=this._pointer1.current,this._pointer1.current=n)}const h=this._pointer0,m=this._pointer1;if(h&&o(h.start,h.current)>this.touchMoveDistance||m&&o(m.start,m.current)>this.touchMoveDistance){if(this.preventAllTap(),m&&h){e.pointers=[h,m];const{start:t,previous:i,current:n}=h,{start:s,previous:l,current:u}=m,c=p(n,u),d=p(i,l),v=p(t,s);e.getPoint=t=>"start"===t?v:"previous"===t?d:c,e.direction=a(d,c),e.moveDirection=a(v,c),e.deltaX=c[0]-d[0],e.moveX=c[0]-v[0],e.deltaY=c[1]-d[1],e.moveY=c[1]-v[1];const _=o(n,u),g=o(i,l),f=o(t,s);f>0&&_>0&&g>0&&(e.scale=_/g,e.moveScale=_/f);let T=r(n,u)-r(i,l);-180>T?T+=360:T>180&&(T-=360),e.angle=T,this._rotateAngle+=T,e.moveAngle=this._rotateAngle,this.emit("rotate",e),f>0&&_>0&&g>0&&this.emit("scale",e),this.emit("multiPan",e),this.emit("gestureMove",e)}else{if(!h)return;{e.pointers=[h];const{start:t,previous:i,current:n}=h;e.getPoint=e=>"start"===e?t:"previous"===e?i:n,e.direction=a(i,n),e.moveDirection=a(t,n),e.deltaX=n[0]-i[0],e.moveX=n[0]-t[0],e.deltaY=n[1]-i[1],e.moveY=n[1]-t[1];const s=Date.now(),o=this._swipePoints||[[],[]];s-((o[1][0]?o[1][0].timestamp:0)||0)>this.swipeDuration&&(o[0]=o[1],o[1]=[]),o[1].push({point:n,timestamp:s}),this._swipePoints=o,this.emit("pan",e)}}this.emit("pointerMove",e)}}function v(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!n()&&!!t.touches,preventDefault:l.bind(t),stopPropagation:u.bind(t),stopImmediatePropagation:c.bind(t)};n()&&t.touches&&(this._noMouseTimer&&clearTimeout(this._noMouseTimer),this._noMouseTimer=+setTimeout((()=>{this._noMouseTimer=0}),this.doubleTapInterval));let i=null,h=null;this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:m}=s(t);for(let t=0,e=m.length;e>t;++t){const e=m[t];this._pointer0&&this._pointer0.identifier===e.identifier?(this._pointer0.changed=!0,i=this._pointer0,this._pointer0=null):this._pointer1&&this._pointer1.identifier===e.identifier&&(this._pointer1.changed=!0,h=this._pointer1,this._pointer1=null)}if(this._pointer1&&!this._pointer0&&(this._pointer0=this._pointer1,this._pointer1=null,h=i,i=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0),this._pointer0){e.pointers=[this._pointer0],this._pointer1?e.pointers.push(this._pointer1):h&&(e.leavePointers=[h],this._rotateAngle=0);const t=p(this._pointer0.start,this._pointer1?this._pointer1.start:h?h.start:[]),i=p(this._pointer0.previous,this._pointer1?this._pointer1.previous:h?h.previous:[]),n=p(this._pointer0.current,this._pointer1?this._pointer1.current:h?h.current:[]);e.getPoint=e=>"start"===e?t:"previous"===e?i:n,this.emit("gestureEnd",e)}else if(i){e.leavePointers=[i],h&&e.leavePointers.push(h);const t=h?p(i.start,h.start):i.start,n=h?p(i.previous,h.previous):i.previous,s=h?p(i.current,h.current):i.current;if(e.getPoint=e=>"start"===e?t:"previous"===e?n:s,this._preventTap||(this.emit("tap",e),this._preventTap=!0),this._preventSingleTap||(this._singleTapTimer=+setTimeout((()=>{this._singleTapTimer=0,e.delayTime=this.doubleTapInterval,this.emit("singleTap",e)}),this.doubleTapInterval),this._preventSingleTap=!0),!this._preventDoubleTap){const t=this._firstPointer;t&&(e.getPoint=()=>t.current),e.intervalTime=this.doubleTapInterval,this.emit("doubleTap",e),this._firstPointer=null,this._preventDoubleTap=!0}if(this._swipePoints){const[t,i]=this._swipePoints,n=i[i.length-1];if(Date.now()-n.timestamp<=this.raiseDuration){let s=i[0];for(let e=t.length-1;e>=0&&n.timestamp-t[e].timestamp<=this.swipeDuration;e--)s=t[e];const p=(d=n.timestamp-s.timestamp,"number"!=typeof(v=o(s.point,n.point))||0===v||"number"!=typeof d||0===d?0:v/d);if(p>this.swipeVelocity){const t=r(s.point,n.point);e.direction=a(s.point,n.point),e.angle=t,e.velocity=p,e.swipeComputed=(e,i=p)=>{let n=0,s=0,o=0;e>1?(n=e,s=i/n,o=i*n/2):e>0&&(s=e,n=i/s,o=i*i/(2*s));const[r,a]=function(t,e){if("number"!=typeof t||"number"!=typeof e)return[0,0];const i=e*Math.PI/180;return[t*Math.cos(i),t*Math.sin(i)]}(o,t);return{duration:n,stretchX:r,stretchY:a,deceleration:s}},this.emit("swipe",e),this._swipePoints=null}}}}var d,v;this.emit("pointerEnd",e)}function _(t){this.emit("pointerCancel",{sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!n()&&!!t.touches,preventDefault:l.bind(t),stopPropagation:u.bind(t),stopImmediatePropagation:c.bind(t)}),v.call(this,t)}function g(t){const e=this;if(!e._noMouseTimer)if("undefined"!=typeof window&&(window.addEventListener("mousemove",r,{capture:!1,passive:!1}),window.addEventListener("mouseup",p,{capture:!1,passive:!1}),window.addEventListener("blur",s,{capture:!0,passive:!1}),window.addEventListener("dragstart",n,{capture:!0,passive:!1}),"onselectstart"in window.document.documentElement&&window.addEventListener("selectstart",n,{capture:!0,passive:!1})),0===t.button)m.call(e,t);else{e._wheelTimerEnd&&(clearTimeout(e._wheelTimerEnd.timer),e._wheelTimerEnd.wheelEnd(),e._wheelTimerEnd=null);const i=[t.pageX,t.pageY];e._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0}}function i(){"undefined"!=typeof window&&(window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",p),window.removeEventListener("blur",s),window.removeEventListener("dragstart",n),"onselectstart"in window.document.documentElement&&window.removeEventListener("selectstart",n))}function n(t){t.preventDefault()}function s(t){n(t),i()}function r(i){if(0===t.button)d.call(e,i);else{const t={sourceEvent:i,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!1,preventDefault:l.bind(i),stopPropagation:u.bind(i),stopImmediatePropagation:c.bind(i)},n=[i.pageX,i.pageY];if(e._pointer0&&o(e._pointer0.start,n)>e.touchMoveDistance){e._pointer0.previous=e._pointer0.current,e._pointer0.current=n,t.pointers=[e._pointer0];const{start:i,previous:s,current:o}=e._pointer0;t.getPoint=t=>"start"===t?i:"previous"===t?s:o,t.direction=a(s,o),t.moveDirection=a(i,o),t.deltaX=o[0]-s[0],t.moveX=o[0]-i[0],t.deltaY=o[1]-s[1],t.moveY=o[1]-i[1],t.angle=t.deltaX/4,t.moveAngle=t.moveX/4,e.emit("rotate",t)}}}function p(n){if(i(),0===t.button)v.call(e,n);else{const t={sourceEvent:n,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!1,preventDefault:l.bind(n),stopPropagation:u.bind(n),stopImmediatePropagation:c.bind(n)},i=[n.pageX,n.pageY];if(e._pointer0){const n=e._pointer0;e._pointer0=null,n.previous=n.current,n.current=i,t.leavePointers=[n];const{start:s,previous:o,current:r}=n;t.getPoint=t=>"start"===t?s:"previous"===t?o:r}t.angle=NaN,e.emit("rotate",t)}}}function f(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!1,preventDefault:l.bind(t),stopPropagation:u.bind(t),stopImmediatePropagation:c.bind(t)},i=[t.pageX,t.pageY];this._wheelTimerEnd?(this._pointer0&&(this._pointer0.previous=this._pointer0.current,this._pointer0.current=i),clearTimeout(this._wheelTimerEnd.timer)):this._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0};const n=()=>{this._pointer0=null,this._wheelTimerEnd=null,e.timestamp=Date.now(),e.scale=NaN,this.emit("scale",e)};if(this._wheelTimerEnd={wheelEnd:n,timer:+setTimeout(n,this.wheelDelay),scale:this._wheelTimerEnd?this._wheelTimerEnd.scale:1},this._pointer0){e.pointers=[this._pointer0];const{start:i,previous:n,current:s}=this._pointer0;e.getPoint=t=>"start"===t?i:"previous"===t?n:s;const o=Math.pow(2,-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002));this._wheelTimerEnd.scale*=o,e.moveScale=this._wheelTimerEnd.scale,e.scale=o,this.emit("scale",e)}}class T extends h{constructor(t,e){super(e),this.element=null,this._unbind=null;const i=function(t){let e=t;return"string"==typeof t&&(e=document.querySelector(t)),"function"==typeof t&&(e=t()),e||null}(t);if(!i)throw Error("Please pass in a valid element...");this.element=i;let s=()=>{};if(n()){const t=m.bind(this),e=d.bind(this),n=v.bind(this),o=_.bind(this);i.addEventListener("touchstart",t,{capture:!1,passive:!1}),i.addEventListener("touchmove",e,{capture:!1,passive:!1}),i.addEventListener("touchend",n,{capture:!1,passive:!1}),i.addEventListener("touchcancel",o,{capture:!1,passive:!1}),s=()=>{i.removeEventListener("touchstart",t),i.removeEventListener("touchmove",e),i.removeEventListener("touchend",n),i.removeEventListener("touchcancel",o)}}const o=g.bind(this),r=f.bind(this);i.addEventListener("mousedown",o,{capture:!1,passive:!1}),i.addEventListener("wheel",r,{capture:!1,passive:!1}),this._unbind=()=>{i.removeEventListener("mousedown",o),i.removeEventListener("wheel",r),s()}}destory(){super.off(),this._unbind&&(this._unbind(),this._unbind=null,this.element=null)}}export{T as default};
//# sourceMappingURL=gesture.min.js.map
