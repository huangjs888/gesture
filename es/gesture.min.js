class e{constructor(){this.events={},this.events={}}one(e,t,i){const n="function"==typeof t?(...s)=>{t.apply(null,s),this.off(e,n,i)}:t;this.on(e,n,i)}on(e,t,i){const n=this.events[e]||{pool:[],single:-1};if("function"==typeof t)if(i)-1===n.single?n.single=n.pool.push(t)-1:n.pool[n.single]=t;else{let e=!0;for(let i=0,s=n.pool.length;s>i;i++)if(n.pool[i]===t&&i!==n.single){e=!1;break}e&&n.pool.push(t)}else i&&-1!==n.single&&(n.pool.splice(n.single,1),n.single=-1);this.events[e]=n}off(e,t,i){if(void 0===e)this.events={};else if(void 0===t)delete this.events[e];else if(i){const t=this.events[e];t&&-1!==t.single&&(t.pool.splice(t.single,1),t.single=-1)}else{const i=this.events[e];if(i)for(let e=i.pool.length-1;e>=0;e--)if(i.pool[e]===t&&e!==i.single){i.pool.splice(e,1);break}}}emit(e,t){const i=this.events[e];if(i)for(let n=0,s=i.pool.length;s>n;n++){const s=i.pool[n];if("function"==typeof s){if(!1===s.call(null,t,e))break}}}}const t=(e,t)=>{let i=e;for(;i&&i!==t;)i=i.parentNode;return!!i};function i(e,t,i){return"number"!=typeof e||i>e?t:e}function n(){return window.navigator.maxTouchPoints||"ontouchstart"in window.document}function s(e,i=!1){if(e.touches){if(i){const i=Array.prototype.filter.call(e.touches,(i=>t(i.target,e.currentTarget))).map((e=>({pageX:e.pageX,pageY:e.pageY,identifier:e.identifier})));return{points:i,isFirst:e.changedTouches.length===i.length}}return{points:Array.prototype.slice.call(e.changedTouches||[]).map((e=>({pageX:e.pageX,pageY:e.pageY,identifier:e.identifier})))}}return{points:[{pageX:e.pageX,pageY:e.pageY,identifier:-1}],isFirst:i}}function o([e,t],[i,n]){return"number"==typeof e&&"number"==typeof i&&"number"==typeof t&&"number"==typeof n?Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)):0}function r([e,t],[i,n]){return"number"==typeof e&&"number"==typeof i&&"number"==typeof t&&"number"==typeof n?180*Math.atan2(n-t,i-e)/Math.PI:0}function p([e,t],[i,n]){const s="number"==typeof e&&"number"==typeof t,o="number"==typeof i&&"number"==typeof n;return s||o?s&&!o?[e,t]:!s&&o?[i,n]:[(e+i)/2,(t+n)/2]:[0,0]}function a([e,t],[i,n]){if("number"==typeof e&&"number"==typeof i&&"number"==typeof t&&"number"==typeof n){const s=e-i,o=t-n;if(s!==o)return Math.abs(o)>Math.abs(s)?t-n>0?"Up":"Down":e-i>0?"Left":"Right"}return"None"}let l=class extends e{constructor(e){super(),this.wheelDelay=350,this.longTapInterval=750,this.doubleTapInterval=250,this.doubleTapDistance=30,this.touchMoveDistance=3,this.swipeVelocity=.3,this.swipeDuration=100,this.raiseDuration=100,this._rotateAngle=0,this._singleTapTimer=0,this._longTapTimer=0,this._wheelTimerEnd=null,this._preventTap=!0,this._swipePoints=null,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._firstPointer=null,this._pointer0=null,this._pointer1=null,this.resetOptions(e)}resetOptions(e){const{wheelDelay:t,longTapInterval:n,doubleTapInterval:s,doubleTapDistance:o,touchMoveDistance:r,swipeVelocity:p,swipeDuration:a,raiseDuration:l}=e||{};this.wheelDelay=i(t,350,1),this.longTapInterval=i(n,750,1),this.doubleTapInterval=i(s,250,1),this.doubleTapDistance=i(o,30,1),this.touchMoveDistance=i(r,3,0),this.swipeVelocity=i(p,.3,0),this.swipeDuration=i(a,100,1),this.raiseDuration=i(l,100,1)}preventAllTap(e=!0){this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,e&&(this._firstPointer=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0)}};function h(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},{points:i,isFirst:n}=s(e,!0);n?(this._wheelTimerEnd&&(clearTimeout(this._wheelTimerEnd.timer),this._wheelTimerEnd.wheelEnd(),this._wheelTimerEnd=null),this._pointer0=null,this._pointer1=null):(this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1));for(let e=0,t=i.length;t>e;++e){const t=i[e],n=[t.pageX,t.pageY],s={start:n,previous:n,current:n,identifier:t.identifier,changed:!0};this._pointer0?this._pointer1||this._pointer0.identifier===t.identifier||(this._pointer1=s):this._pointer0=s}this.preventAllTap(!1),this._swipePoints=null,this._rotateAngle=0;const r=this._pointer0,a=this._pointer1;if(a&&r)this._firstPointer=null,t.pointers=[r,a],t.getPoint=()=>p(r.current,a.current),this.emit("gestureStart",t);else{if(!r)return;{t.pointers=[r],t.getPoint=()=>r.current,this._preventTap=!1,this._longTapTimer=+setTimeout((()=>{this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._longTapTimer=0,this._firstPointer=null,t.waitTime=this.longTapInterval,this.emit("longTap",t)}),this.longTapInterval);const e=this._firstPointer,i=this._singleTapTimer;i&&e&&o(e.current,r.current)<this.doubleTapDistance?(clearTimeout(i),this._singleTapTimer=0,this._preventSingleTap=!0,this._preventDoubleTap=!1,t.getPoint=()=>e.current):(this._firstPointer=r,this._preventSingleTap=!1,this._preventDoubleTap=!0)}}this.emit("pointerStart",t)}function u(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]};this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:i}=s(e);for(let e=0,t=i.length;t>e;++e){const t=i[e],n=[t.pageX,t.pageY];this._pointer0&&this._pointer0.identifier===t.identifier?(this._pointer0.changed=!0,this._pointer0.previous=this._pointer0.current,this._pointer0.current=n):this._pointer1&&this._pointer1.identifier===t.identifier&&(this._pointer1.changed=!0,this._pointer1.previous=this._pointer1.current,this._pointer1.current=n)}const n=this._pointer0,l=this._pointer1;if(n&&o(n.start,n.current)>this.touchMoveDistance||l&&o(l.start,l.current)>this.touchMoveDistance){if(this.preventAllTap(),l&&n){t.pointers=[n,l];const{start:e,previous:i,current:s}=n,{start:h,previous:u,current:c}=l,m=p(s,c),d=p(i,u),_=p(e,h);t.getPoint=e=>"start"===e?_:"previous"===e?d:m,t.direction=a(d,m),t.moveDirection=a(_,m),t.deltaX=m[0]-d[0],t.moveX=m[0]-_[0],t.deltaY=m[1]-d[1],t.moveY=m[1]-_[1];const v=o(s,c),f=o(i,u),g=o(e,h);g>0&&v>0&&f>0&&(t.scale=v/f,t.moveScale=v/g);let T=r(s,c)-r(i,u);-180>T?T+=360:T>180&&(T-=360),t.angle=T,this._rotateAngle+=T,t.moveAngle=this._rotateAngle,this.emit("rotate",t),g>0&&v>0&&f>0&&this.emit("scale",t),this.emit("multiPan",t),this.emit("gestureMove",t)}else{if(!n)return;{t.pointers=[n];const{start:e,previous:i,current:s}=n;t.getPoint=t=>"start"===t?e:"previous"===t?i:s,t.direction=a(i,s),t.moveDirection=a(e,s),t.deltaX=s[0]-i[0],t.moveX=s[0]-e[0],t.deltaY=s[1]-i[1],t.moveY=s[1]-e[1];const o=Date.now(),r=this._swipePoints||[[],[]];o-((r[1][0]?r[1][0].timestamp:0)||0)>this.swipeDuration&&(r[0]=r[1],r[1]=[]),r[1].push({point:s,timestamp:o}),this._swipePoints=r,this.emit("pan",t)}}this.emit("pointerMove",t)}}function c(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]};let i=null,n=null;this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:l}=s(e);for(let e=0,t=l.length;t>e;++e){const t=l[e];this._pointer0&&this._pointer0.identifier===t.identifier?(this._pointer0.changed=!0,i=this._pointer0,this._pointer0=null):this._pointer1&&this._pointer1.identifier===t.identifier&&(this._pointer1.changed=!0,n=this._pointer1,this._pointer1=null)}if(this._pointer1&&!this._pointer0&&(this._pointer0=this._pointer1,this._pointer1=null,n=i,i=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0),this._pointer0){t.pointers=[this._pointer0],this._pointer1?t.pointers.push(this._pointer1):n&&(t.leavePointers=[n],this._rotateAngle=0);const e=p(this._pointer0.start,this._pointer1?this._pointer1.start:n?n.start:[]),i=p(this._pointer0.previous,this._pointer1?this._pointer1.previous:n?n.previous:[]),s=p(this._pointer0.current,this._pointer1?this._pointer1.current:n?n.current:[]);t.getPoint=t=>"start"===t?e:"previous"===t?i:s,this.emit("gestureEnd",t)}else if(i){t.leavePointers=[i],n&&t.leavePointers.push(n);const e=n?p(i.start,n.start):i.start,s=n?p(i.previous,n.previous):i.previous,l=n?p(i.current,n.current):i.current;if(t.getPoint=t=>"start"===t?e:"previous"===t?s:l,this._preventTap||(this.emit("tap",t),this._preventTap=!0),this._preventSingleTap||(this._singleTapTimer=+setTimeout((()=>{this._singleTapTimer=0,t.delayTime=this.doubleTapInterval,this.emit("singleTap",t)}),this.doubleTapInterval),this._preventSingleTap=!0),!this._preventDoubleTap){const e=this._firstPointer;e&&(t.getPoint=()=>e.current),t.intervalTime=this.doubleTapInterval,this.emit("doubleTap",t),this._firstPointer=null,this._preventDoubleTap=!0}if(this._swipePoints){const[e,i]=this._swipePoints,n=i[i.length-1];if(Date.now()-n.timestamp<=this.raiseDuration){let s=i[0];for(let t=e.length-1;t>=0&&n.timestamp-e[t].timestamp<=this.swipeDuration;t--)s=e[t];const p=(h=n.timestamp-s.timestamp,"number"!=typeof(u=o(s.point,n.point))||0===u||"number"!=typeof h||0===h?0:u/h);if(p>this.swipeVelocity){const e=r(s.point,n.point);t.direction=a(s.point,n.point),t.angle=e,t.velocity=p,t.swipeComputed=(t,i=p)=>{let n=0,s=0,o=0;t>1?(n=t,s=i/n,o=i*n/2):t>0&&(s=t,n=i/s,o=i*i/(2*s));const[r,a]=function(e,t){if("number"!=typeof e||"number"!=typeof t)return[0,0];const i=t*Math.PI/180;return[e*Math.cos(i),e*Math.sin(i)]}(o,e);return{duration:n,stretchX:r,stretchY:a,deceleration:s}},this.emit("swipe",t),this._swipePoints=null}}}}var h,u;this.emit("pointerEnd",t)}function m(e){this.emit("pointerCancel",{sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]}),c.call(this,e)}function d(e){const t=this;function i(){"undefined"!=typeof window&&(window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r),window.removeEventListener("blur",n),window.removeEventListener("dragstart",s),"onselectstart"in window.document.documentElement&&window.removeEventListener("selectstart",s))}function n(e){e.preventDefault(),e.stopPropagation(),i()}function s(e){e.preventDefault(),e.stopPropagation()}function o(i){if(0===e.button)u.call(t,i);else{const n={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},s=[i.pageX,i.pageY];if(t._pointer0){t._pointer0.previous=t._pointer0.current,t._pointer0.current=s,n.pointers=[t._pointer0];const{start:e,previous:i,current:o}=t._pointer0;n.getPoint=t=>"start"===t?e:"previous"===t?i:o,n.direction=a(i,o),n.moveDirection=a(e,o),n.deltaX=o[0]-i[0],n.moveX=o[0]-e[0],n.deltaY=o[1]-i[1],n.moveY=o[1]-e[1],n.angle=n.deltaX/4,n.moveAngle=n.moveX/4,t.emit("rotate",n)}}}function r(n){if(i(),0===e.button)c.call(t,n);else{const i={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},s=[n.pageX,n.pageY];if(t._pointer0){const e=t._pointer0;t._pointer0=null,e.previous=e.current,e.current=s,i.leavePointers=[e];const{start:n,previous:o,current:r}=e;i.getPoint=e=>"start"===e?n:"previous"===e?o:r}i.angle=NaN,t.emit("rotate",i)}}if("undefined"!=typeof window&&(window.addEventListener("mousemove",o),window.addEventListener("mouseup",r),window.addEventListener("blur",n),window.addEventListener("dragstart",s,{capture:!0,passive:!1}),"onselectstart"in window.document.documentElement&&window.addEventListener("selectstart",s,{capture:!0,passive:!1})),0===e.button)h.call(t,e);else{t._wheelTimerEnd&&(clearTimeout(t._wheelTimerEnd.timer),t._wheelTimerEnd.wheelEnd(),t._wheelTimerEnd=null);const i=[e.pageX,e.pageY];t._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0}}}function _(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},i=[e.pageX,e.pageY];this._wheelTimerEnd?(this._pointer0&&(this._pointer0.previous=this._pointer0.current,this._pointer0.current=i),clearTimeout(this._wheelTimerEnd.timer)):this._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0};const n=()=>{this._pointer0=null,this._wheelTimerEnd=null,t.timestamp=Date.now(),t.scale=NaN,this.emit("scale",t)};if(this._wheelTimerEnd={wheelEnd:n,timer:+setTimeout(n,this.wheelDelay),scale:this._wheelTimerEnd?this._wheelTimerEnd.scale:1},this._pointer0){t.pointers=[this._pointer0];const{start:i,previous:n,current:s}=this._pointer0;t.getPoint=e=>"start"===e?i:"previous"===e?n:s;const o=Math.pow(2,-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002));this._wheelTimerEnd.scale*=o,t.moveScale=this._wheelTimerEnd.scale,t.scale=o,this.emit("scale",t)}}class v extends l{constructor(e,t){super(t),this.element=null,this._unbind=null;const i=function(e){let t=e;return"string"==typeof e&&(t=document.querySelector(e)),"function"==typeof e&&(t=e()),t||null}(e);if(!i)throw Error("Please pass in a valid element...");if(this.element=i,n()){const e=h.bind(this),t=u.bind(this),n=c.bind(this),s=m.bind(this);i.addEventListener("touchstart",e,!1),i.addEventListener("touchmove",t,!1),i.addEventListener("touchend",n,!1),i.addEventListener("touchcancel",s,!1),this._unbind=()=>{i.removeEventListener("touchstart",e),i.removeEventListener("touchmove",t),i.removeEventListener("touchend",n),i.removeEventListener("touchcancel",s)}}else{const e=d.bind(this),t=_.bind(this);i.addEventListener("mousedown",e,!1),i.addEventListener("wheel",t,!1),this._unbind=()=>{i.removeEventListener("mousedown",e),i.removeEventListener("wheel",t)}}}destory(){super.off(),this._unbind&&(this._unbind(),this._unbind=null,this.element=null)}}export{v as default,n as isTouchable};
//# sourceMappingURL=gesture.min.js.map
