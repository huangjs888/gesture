import t from"react";import e from"react-dom";function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;arguments.length>e;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},i.apply(this,arguments)}const n=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?t.useLayoutEffect:t.useEffect;function o(t,e,i){n((()=>{const n=t=>{"function"==typeof i&&i.call(null,t)};return t.on(e,n),()=>{t.off(e,n)}}),[t,e,i])}class s{constructor(){this.events={},this.events={}}one(t,e,i){const n="function"==typeof e?(...o)=>{e.apply(null,o),this.off(t,n,i)}:e;this.on(t,n,i)}on(t,e,i){const n=this.events[t]||{pool:[],single:-1};if("function"==typeof e)if(i)-1===n.single?n.single=n.pool.push(e)-1:n.pool[n.single]=e;else{let t=!0;for(let i=0,o=n.pool.length;o>i;i++)if(n.pool[i]===e&&i!==n.single){t=!1;break}t&&n.pool.push(e)}else i&&-1!==n.single&&(n.pool.splice(n.single,1),n.single=-1);this.events[t]=n}off(t,e,i){if(void 0===t)this.events={};else if(void 0===e)delete this.events[t];else if(i){const e=this.events[t];e&&-1!==e.single&&(e.pool.splice(e.single,1),e.single=-1)}else{const i=this.events[t];if(i)for(let t=i.pool.length-1;t>=0;t--)if(i.pool[t]===e&&t!==i.single){i.pool.splice(t,1);break}}}emit(t,e){const i=this.events[t];if(i)for(let n=0,o=i.pool.length;o>n;n++){const o=i.pool[n];if("function"==typeof o){if(!1===o.call(null,e,t))break}}}}const r=(t,e)=>{let i=t;for(;i&&i!==e;)i=i.parentNode;return!!i};function p(t,e,i){return"number"!=typeof t||i>t?e:t}function a(){return window.navigator.maxTouchPoints||"ontouchstart"in window.document}function l(t,e=!1){if(t.touches){if(e){const e=Array.prototype.filter.call(t.touches,(e=>r(e.target,t.currentTarget))).map((t=>({pageX:t.pageX,pageY:t.pageY,identifier:t.identifier})));return{points:e,isFirst:t.changedTouches.length===e.length}}return{points:Array.prototype.slice.call(t.changedTouches||[]).map((t=>({pageX:t.pageX,pageY:t.pageY,identifier:t.identifier})))}}return{points:[{pageX:t.pageX,pageY:t.pageY,identifier:-1}],isFirst:e}}function h([t,e],[i,n]){return"number"==typeof t&&"number"==typeof i&&"number"==typeof e&&"number"==typeof n?Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2)):0}function u([t,e],[i,n]){return"number"==typeof t&&"number"==typeof i&&"number"==typeof e&&"number"==typeof n?180*Math.atan2(n-e,i-t)/Math.PI:0}function c([t,e],[i,n]){const o="number"==typeof t&&"number"==typeof e,s="number"==typeof i&&"number"==typeof n;return o||s?o&&!s?[t,e]:!o&&s?[i,n]:[(t+i)/2,(e+n)/2]:[0,0]}function m([t,e],[i,n]){if("number"==typeof t&&"number"==typeof i&&"number"==typeof e&&"number"==typeof n){const o=t-i,s=e-n;if(o!==s)return Math.abs(s)>Math.abs(o)?e-n>0?"Up":"Down":t-i>0?"Left":"Right"}return"None"}let d=class extends s{constructor(t){super(),this.wheelDelay=350,this.longTapInterval=750,this.doubleTapInterval=250,this.doubleTapDistance=30,this.touchMoveDistance=3,this.swipeVelocity=.3,this.swipeDuration=100,this.raiseDuration=100,this._rotateAngle=0,this._noMouseTimer=0,this._singleTapTimer=0,this._longTapTimer=0,this._wheelTimerEnd=null,this._preventTap=!0,this._swipePoints=null,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._firstPointer=null,this._pointer0=null,this._pointer1=null,this.resetOptions(t)}resetOptions(t){const{wheelDelay:e,longTapInterval:i,doubleTapInterval:n,doubleTapDistance:o,touchMoveDistance:s,swipeVelocity:r,swipeDuration:a,raiseDuration:l}=t||{};this.wheelDelay=p(e,350,1),this.longTapInterval=p(i,750,1),this.doubleTapInterval=p(n,250,1),this.doubleTapDistance=p(o,30,1),this.touchMoveDistance=p(s,3,0),this.swipeVelocity=p(r,.3,0),this.swipeDuration=p(a,100,1),this.raiseDuration=p(l,100,1)}preventAllTap(t=!0){this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,t&&(this._firstPointer=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0)}};function v(){this.nativeEvent||(this.preventDefault?this.preventDefault():this.returnValue=!1)}function f(){this.stopPropagation?this.stopPropagation():this.cancelBubble=!0}function g(){this.nativeEvent?this.nativeEvent.stopImmediatePropagation&&this.nativeEvent.stopImmediatePropagation():this.stopImmediatePropagation?this.stopImmediatePropagation():f.call(this)}function _(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!a()&&!!t.touches,preventDefault:v.bind(t),stopPropagation:f.bind(t),stopImmediatePropagation:g.bind(t)},{points:i,isFirst:n}=l(t,!0);n?(this._wheelTimerEnd&&(clearTimeout(this._wheelTimerEnd.timer),this._wheelTimerEnd.wheelEnd(),this._wheelTimerEnd=null),this._pointer0=null,this._pointer1=null):(this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1));for(let t=0,e=i.length;e>t;++t){const e=i[t],n=[e.pageX,e.pageY],o={start:n,previous:n,current:n,identifier:e.identifier,changed:!0};this._pointer0?this._pointer1||this._pointer0.identifier===e.identifier||(this._pointer1=o):this._pointer0=o}this.preventAllTap(!1),this._swipePoints=null,this._rotateAngle=0;const o=this._pointer0,s=this._pointer1;if(s&&o)this._firstPointer=null,e.pointers=[o,s],e.getPoint=()=>c(o.current,s.current),this.emit("gestureStart",e);else{if(!o)return;{e.pointers=[o],e.getPoint=()=>o.current,this._preventTap=!1,this._longTapTimer=+setTimeout((()=>{this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._longTapTimer=0,this._firstPointer=null,e.waitTime=this.longTapInterval,this.emit("longTap",e)}),this.longTapInterval);const t=this._firstPointer,i=this._singleTapTimer;i&&t&&h(t.current,o.current)<this.doubleTapDistance?(clearTimeout(i),this._singleTapTimer=0,this._preventSingleTap=!0,this._preventDoubleTap=!1,e.getPoint=()=>t.current):(this._firstPointer=o,this._preventSingleTap=!1,this._preventDoubleTap=!0)}}this.emit("pointerStart",e)}function T(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!a()&&!!t.touches,preventDefault:v.bind(t),stopPropagation:f.bind(t),stopImmediatePropagation:g.bind(t)};this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:i}=l(t);for(let t=0,e=i.length;e>t;++t){const e=i[t],n=[e.pageX,e.pageY];this._pointer0&&this._pointer0.identifier===e.identifier?(this._pointer0.changed=!0,this._pointer0.previous=this._pointer0.current,this._pointer0.current=n):this._pointer1&&this._pointer1.identifier===e.identifier&&(this._pointer1.changed=!0,this._pointer1.previous=this._pointer1.current,this._pointer1.current=n)}const n=this._pointer0,o=this._pointer1;if(n&&h(n.start,n.current)>this.touchMoveDistance||o&&h(o.start,o.current)>this.touchMoveDistance){if(this.preventAllTap(),o&&n){e.pointers=[n,o];const{start:t,previous:i,current:s}=n,{start:r,previous:p,current:a}=o,l=c(s,a),d=c(i,p),v=c(t,r);e.getPoint=t=>"start"===t?v:"previous"===t?d:l,e.direction=m(d,l),e.moveDirection=m(v,l),e.deltaX=l[0]-d[0],e.moveX=l[0]-v[0],e.deltaY=l[1]-d[1],e.moveY=l[1]-v[1];const f=h(s,a),g=h(i,p),_=h(t,r);_>0&&f>0&&g>0&&(e.scale=f/g,e.moveScale=f/_);let T=u(s,a)-u(i,p);-180>T?T+=360:T>180&&(T-=360),e.angle=T,this._rotateAngle+=T,e.moveAngle=this._rotateAngle,this.emit("rotate",e),_>0&&f>0&&g>0&&this.emit("scale",e),this.emit("multiPan",e),this.emit("gestureMove",e)}else{if(!n)return;{e.pointers=[n];const{start:t,previous:i,current:o}=n;e.getPoint=e=>"start"===e?t:"previous"===e?i:o,e.direction=m(i,o),e.moveDirection=m(t,o),e.deltaX=o[0]-i[0],e.moveX=o[0]-t[0],e.deltaY=o[1]-i[1],e.moveY=o[1]-t[1];const s=Date.now(),r=this._swipePoints||[[],[]];s-((r[1][0]?r[1][0].timestamp:0)||0)>this.swipeDuration&&(r[0]=r[1],r[1]=[]),r[1].push({point:o,timestamp:s}),this._swipePoints=r,this.emit("pan",e)}}this.emit("pointerMove",e)}}function w(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!a()&&!!t.touches,preventDefault:v.bind(t),stopPropagation:f.bind(t),stopImmediatePropagation:g.bind(t)};a()&&t.touches&&(this._noMouseTimer&&clearTimeout(this._noMouseTimer),this._noMouseTimer=+setTimeout((()=>{this._noMouseTimer=0}),this.doubleTapInterval));let i=null,n=null;this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:o}=l(t);for(let t=0,e=o.length;e>t;++t){const e=o[t];this._pointer0&&this._pointer0.identifier===e.identifier?(this._pointer0.changed=!0,i=this._pointer0,this._pointer0=null):this._pointer1&&this._pointer1.identifier===e.identifier&&(this._pointer1.changed=!0,n=this._pointer1,this._pointer1=null)}if(this._pointer1&&!this._pointer0&&(this._pointer0=this._pointer1,this._pointer1=null,n=i,i=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0),this._pointer0){e.pointers=[this._pointer0],this._pointer1?e.pointers.push(this._pointer1):n&&(e.leavePointers=[n],this._rotateAngle=0);const t=c(this._pointer0.start,this._pointer1?this._pointer1.start:n?n.start:[]),i=c(this._pointer0.previous,this._pointer1?this._pointer1.previous:n?n.previous:[]),o=c(this._pointer0.current,this._pointer1?this._pointer1.current:n?n.current:[]);e.getPoint=e=>"start"===e?t:"previous"===e?i:o,this.emit("gestureEnd",e)}else if(i){e.leavePointers=[i],n&&e.leavePointers.push(n);const t=n?c(i.start,n.start):i.start,o=n?c(i.previous,n.previous):i.previous,p=n?c(i.current,n.current):i.current;if(e.getPoint=e=>"start"===e?t:"previous"===e?o:p,this._preventTap||(this.emit("tap",e),this._preventTap=!0),this._preventSingleTap||(this._singleTapTimer=+setTimeout((()=>{this._singleTapTimer=0,e.delayTime=this.doubleTapInterval,this.emit("singleTap",e)}),this.doubleTapInterval),this._preventSingleTap=!0),!this._preventDoubleTap){const t=this._firstPointer;t&&(e.getPoint=()=>t.current),e.intervalTime=this.doubleTapInterval,this.emit("doubleTap",e),this._firstPointer=null,this._preventDoubleTap=!0}if(this._swipePoints){const[t,i]=this._swipePoints,n=i[i.length-1];if(Date.now()-n.timestamp<=this.raiseDuration){let o=i[0];for(let e=t.length-1;e>=0&&n.timestamp-t[e].timestamp<=this.swipeDuration;e--)o=t[e];const p=(s=n.timestamp-o.timestamp,"number"!=typeof(r=h(o.point,n.point))||0===r||"number"!=typeof s||0===s?0:r/s);if(p>this.swipeVelocity){const t=u(o.point,n.point);e.direction=m(o.point,n.point),e.angle=t,e.velocity=p,e.swipeComputed=(e,i=p)=>{let n=0,o=0,s=0;e>1?(n=e,o=i/n,s=i*n/2):e>0&&(o=e,n=i/o,s=i*i/(2*o));const[r,a]=function(t,e){if("number"!=typeof t||"number"!=typeof e)return[0,0];const i=e*Math.PI/180;return[t*Math.cos(i),t*Math.sin(i)]}(s,t);return{duration:n,stretchX:r,stretchY:a,deceleration:o}},this.emit("swipe",e),this._swipePoints=null}}}}var s,r;this.emit("pointerEnd",e)}function b(t){this.emit("pointerCancel",{sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!!a()&&!!t.touches,preventDefault:v.bind(t),stopPropagation:f.bind(t),stopImmediatePropagation:g.bind(t)}),w.call(this,t)}function P(t){const e=this;if(!e._noMouseTimer)if("undefined"!=typeof window&&(window.addEventListener("mousemove",s,{capture:!1,passive:!1}),window.addEventListener("mouseup",r,{capture:!1,passive:!1}),window.addEventListener("blur",o,{capture:!0,passive:!1}),window.addEventListener("dragstart",n,{capture:!0,passive:!1}),"onselectstart"in window.document.documentElement&&window.addEventListener("selectstart",n,{capture:!0,passive:!1})),0===t.button)_.call(e,t);else{e._wheelTimerEnd&&(clearTimeout(e._wheelTimerEnd.timer),e._wheelTimerEnd.wheelEnd(),e._wheelTimerEnd=null);const i=[t.pageX,t.pageY];e._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0}}function i(){"undefined"!=typeof window&&(window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r),window.removeEventListener("blur",o),window.removeEventListener("dragstart",n),"onselectstart"in window.document.documentElement&&window.removeEventListener("selectstart",n))}function n(t){t.preventDefault()}function o(t){n(t),i()}function s(i){if(0===t.button)T.call(e,i);else{const t={sourceEvent:i,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!1,preventDefault:v.bind(i),stopPropagation:f.bind(i),stopImmediatePropagation:g.bind(i)},n=[i.pageX,i.pageY];if(e._pointer0&&h(e._pointer0.start,n)>e.touchMoveDistance){e._pointer0.previous=e._pointer0.current,e._pointer0.current=n,t.pointers=[e._pointer0];const{start:i,previous:o,current:s}=e._pointer0;t.getPoint=t=>"start"===t?i:"previous"===t?o:s,t.direction=m(o,s),t.moveDirection=m(i,s),t.deltaX=s[0]-o[0],t.moveX=s[0]-i[0],t.deltaY=s[1]-o[1],t.moveY=s[1]-i[1],t.angle=t.deltaX/4,t.moveAngle=t.moveX/4,e.emit("rotate",t)}}}function r(n){if(i(),0===t.button)w.call(e,n);else{const t={sourceEvent:n,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!1,preventDefault:v.bind(n),stopPropagation:f.bind(n),stopImmediatePropagation:g.bind(n)},i=[n.pageX,n.pageY];if(e._pointer0){const n=e._pointer0;e._pointer0=null,n.previous=n.current,n.current=i,t.leavePointers=[n];const{start:o,previous:s,current:r}=n;t.getPoint=t=>"start"===t?o:"previous"===t?s:r}t.angle=NaN,e.emit("rotate",t)}}}function D(t){const e={sourceEvent:t,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0],isTouching:()=>!1,preventDefault:v.bind(t),stopPropagation:f.bind(t),stopImmediatePropagation:g.bind(t)},i=[t.pageX,t.pageY];this._wheelTimerEnd?(this._pointer0&&(this._pointer0.previous=this._pointer0.current,this._pointer0.current=i),clearTimeout(this._wheelTimerEnd.timer)):this._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0};const n=()=>{this._pointer0=null,this._wheelTimerEnd=null,e.timestamp=Date.now(),e.scale=NaN,this.emit("scale",e)};if(this._wheelTimerEnd={wheelEnd:n,timer:+setTimeout(n,this.wheelDelay),scale:this._wheelTimerEnd?this._wheelTimerEnd.scale:1},this._pointer0){e.pointers=[this._pointer0];const{start:i,previous:n,current:o}=this._pointer0;e.getPoint=t=>"start"===t?i:"previous"===t?n:o;const s=Math.pow(2,-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002));this._wheelTimerEnd.scale*=s,e.moveScale=this._wheelTimerEnd.scale,e.scale=s,this.emit("scale",e)}}const E=["children","options","preventAllTap"],y=t.forwardRef(((s,r)=>{let{children:p,options:l,preventAllTap:h}=s,u=function(t,e){if(null==t)return{};var i,n,o={},s=Object.keys(t);for(n=0;s.length>n;n++)0>e.indexOf(i=s[n])&&(o[i]=t[i]);return o}(s,E);const c=t.useRef(),m=t.useRef();m.current||(m.current=new d);const v=m.current;n((()=>{v.resetOptions(l)}),[l]),n((()=>{h&&v.resetOptions(l)}),[h]),function(t,e){const{onPan:i,onTap:n,onSwipe:s,onSingleTap:r,onLongTap:p,onDoubleTap:a,onMultiPan:l,onScale:h,onRotate:u,onPointerStart:c,onPointerMove:m,onPointerEnd:d,onPointerCancel:v,onGestureStart:f,onGestureMove:g,onGestureEnd:_}=t;o(e,"pan",i),o(e,"tap",n),o(e,"swipe",s),o(e,"singleTap",r),o(e,"longTap",p),o(e,"doubleTap",a),o(e,"multiPan",l),o(e,"scale",h),o(e,"rotate",u),o(e,"pointerStart",c),o(e,"pointerMove",m),o(e,"pointerEnd",d),o(e,"pointerCancel",v),o(e,"gestureStart",f),o(e,"gestureMove",g),o(e,"gestureEnd",_)}(u,v),t.useImperativeHandle(r,(()=>({findDOMElement:()=>c.current,getInstance:()=>v})),[v]);const f=t.useCallback((i=>{let n=i;!(i instanceof Element)&&i instanceof t.Component&&(n=e.findDOMNode(i)),n instanceof Element||(n=void 0),c.current=n}),[]),g=t.useMemo((()=>i({},a()?{onTouchStart:_.bind(v),onTouchMove:T.bind(v),onTouchEnd:w.bind(v),onTouchCancel:b.bind(v)}:{},{onMouseDown:P.bind(v),onWheel:D.bind(v)})),[v]);return p?t.Children.only(t.cloneElement(p,i({ref:f},g))):(console.warn("Warning: Gesture children must exist."),null)}));export{y as default};
//# sourceMappingURL=react-gesture.min.js.map
