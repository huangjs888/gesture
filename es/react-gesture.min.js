import e from"react";import t from"react-dom";function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;arguments.length>t;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i.apply(this,arguments)}const n=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?e.useLayoutEffect:e.useEffect;function o(e,t,i){n((()=>{const n=e();if(n){const e=e=>{"function"==typeof i&&i.call(null,e)};return n.on(t,e),()=>{n.off(t,e)}}return()=>{}}),[i,t,e])}class r{constructor(){this.events={},this.events={}}one(e,t,i){const n="function"==typeof t?(...o)=>{t.apply(null,o),this.off(e,n,i)}:t;this.on(e,n,i)}on(e,t,i){const n=this.events[e]||{pool:[],single:-1};if("function"==typeof t)if(i)-1===n.single?n.single=n.pool.push(t)-1:n.pool[n.single]=t;else{let e=!0;for(let i=0,o=n.pool.length;o>i;i++)if(n.pool[i]===t&&i!==n.single){e=!1;break}e&&n.pool.push(t)}else i&&-1!==n.single&&(n.pool.splice(n.single,1),n.single=-1);this.events[e]=n}off(e,t,i){if(void 0===e)this.events={};else if(void 0===t)delete this.events[e];else if(i){const t=this.events[e];t&&-1!==t.single&&(t.pool.splice(t.single,1),t.single=-1)}else{const i=this.events[e];if(i)for(let e=i.pool.length-1;e>=0;e--)if(i.pool[e]===t&&e!==i.single){i.pool.splice(e,1);break}}}emit(e,t){const i=this.events[e];if(i)for(let n=0,o=i.pool.length;o>n;n++){const o=i.pool[n];if("function"==typeof o){if(!1===o.call(null,t,e))break}}}}const s=(e,t)=>{let i=e;for(;i&&i!==t;)i=i.parentNode;return!!i};function p(e,t,i){return"number"!=typeof e||i>e?t:e}function a(){return window.navigator.maxTouchPoints||"ontouchstart"in window.document}function l(e,t=!1){if(e.touches){if(t){const t=Array.prototype.filter.call(e.touches,(t=>s(t.target,e.currentTarget))).map((e=>({pageX:e.pageX,pageY:e.pageY,identifier:e.identifier})));return{points:t,isFirst:e.changedTouches.length===t.length}}return{points:Array.prototype.slice.call(e.changedTouches||[]).map((e=>({pageX:e.pageX,pageY:e.pageY,identifier:e.identifier})))}}return{points:[{pageX:e.pageX,pageY:e.pageY,identifier:-1}],isFirst:t}}function h([e,t],[i,n]){return"number"==typeof e&&"number"==typeof i&&"number"==typeof t&&"number"==typeof n?Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)):0}function u([e,t],[i,n]){return"number"==typeof e&&"number"==typeof i&&"number"==typeof t&&"number"==typeof n?180*Math.atan2(n-t,i-e)/Math.PI:0}function c([e,t],[i,n]){const o="number"==typeof e&&"number"==typeof t,r="number"==typeof i&&"number"==typeof n;return o||r?o&&!r?[e,t]:!o&&r?[i,n]:[(e+i)/2,(t+n)/2]:[0,0]}function m([e,t],[i,n]){if("number"==typeof e&&"number"==typeof i&&"number"==typeof t&&"number"==typeof n){const o=e-i,r=t-n;if(o!==r)return Math.abs(r)>Math.abs(o)?t-n>0?"Up":"Down":e-i>0?"Left":"Right"}return"None"}class f extends r{constructor(e){super(),this.wheelDelay=350,this.longTapInterval=750,this.doubleTapInterval=250,this.doubleTapDistance=30,this.touchMoveDistance=3,this.swipeVelocity=.3,this.swipeDuration=100,this.raiseDuration=100,this._rotateAngle=0,this._singleTapTimer=0,this._longTapTimer=0,this._wheelTimerEnd=null,this._preventTap=!0,this._swipePoints=null,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._firstPointer=null,this._pointer0=null,this._pointer1=null,this.resetOptions(e)}resetOptions(e){const{wheelDelay:t,longTapInterval:i,doubleTapInterval:n,doubleTapDistance:o,touchMoveDistance:r,swipeVelocity:s,swipeDuration:a,raiseDuration:l}=e||{};this.wheelDelay=p(t,350,1),this.longTapInterval=p(i,750,1),this.doubleTapInterval=p(n,250,1),this.doubleTapDistance=p(o,30,1),this.touchMoveDistance=p(r,3,0),this.swipeVelocity=p(s,.3,0),this.swipeDuration=p(a,100,1),this.raiseDuration=p(l,100,1)}preventAllTap(e=!0){this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,e&&(this._firstPointer=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0)}}function d(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},{points:i,isFirst:n}=l(e,!0);n?(this._wheelTimerEnd&&(clearTimeout(this._wheelTimerEnd.timer),this._wheelTimerEnd.wheelEnd(),this._wheelTimerEnd=null),this._pointer0=null,this._pointer1=null):(this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1));for(let e=0,t=i.length;t>e;++e){const t=i[e],n=[t.pageX,t.pageY],o={start:n,previous:n,current:n,identifier:t.identifier,changed:!0};this._pointer0?this._pointer1||this._pointer0.identifier===t.identifier||(this._pointer1=o):this._pointer0=o}this.preventAllTap(!1),this._swipePoints=null,this._rotateAngle=0;const o=this._pointer0,r=this._pointer1;if(r&&o)this._firstPointer=null,t.pointers=[o,r],t.getPoint=()=>c(o.current,r.current),this.emit("gestureStart",t);else{if(!o)return;{t.pointers=[o],t.getPoint=()=>o.current,this._preventTap=!1,this._longTapTimer=+setTimeout((()=>{this._preventTap=!0,this._preventSingleTap=!0,this._preventDoubleTap=!0,this._longTapTimer=0,this._firstPointer=null,t.waitTime=this.longTapInterval,this.emit("longTap",t)}),this.longTapInterval);const e=this._firstPointer,i=this._singleTapTimer;i&&e&&h(e.current,o.current)<this.doubleTapDistance?(clearTimeout(i),this._singleTapTimer=0,this._preventSingleTap=!0,this._preventDoubleTap=!1,t.getPoint=()=>e.current):(this._firstPointer=o,this._preventSingleTap=!1,this._preventDoubleTap=!0)}}this.emit("pointerStart",t)}function _(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]};this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:i}=l(e);for(let e=0,t=i.length;t>e;++e){const t=i[e],n=[t.pageX,t.pageY];this._pointer0&&this._pointer0.identifier===t.identifier?(this._pointer0.changed=!0,this._pointer0.previous=this._pointer0.current,this._pointer0.current=n):this._pointer1&&this._pointer1.identifier===t.identifier&&(this._pointer1.changed=!0,this._pointer1.previous=this._pointer1.current,this._pointer1.current=n)}const n=this._pointer0,o=this._pointer1;if(n&&h(n.start,n.current)>this.touchMoveDistance||o&&h(o.start,o.current)>this.touchMoveDistance){if(this.preventAllTap(),o&&n){t.pointers=[n,o];const{start:e,previous:i,current:r}=n,{start:s,previous:p,current:a}=o,l=c(r,a),f=c(i,p),d=c(e,s);t.getPoint=e=>"start"===e?d:"previous"===e?f:l,t.direction=m(f,l),t.moveDirection=m(d,l),t.deltaX=l[0]-f[0],t.moveX=l[0]-d[0],t.deltaY=l[1]-f[1],t.moveY=l[1]-d[1];const _=h(r,a),v=h(i,p),g=h(e,s);g>0&&_>0&&v>0&&(t.scale=_/v,t.moveScale=_/g);let T=u(r,a)-u(i,p);-180>T?T+=360:T>180&&(T-=360),t.angle=T,this._rotateAngle+=T,t.moveAngle=this._rotateAngle,this.emit("rotate",t),g>0&&_>0&&v>0&&this.emit("scale",t),this.emit("multiPan",t),this.emit("gestureMove",t)}else{if(!n)return;{t.pointers=[n];const{start:e,previous:i,current:o}=n;t.getPoint=t=>"start"===t?e:"previous"===t?i:o,t.direction=m(i,o),t.moveDirection=m(e,o),t.deltaX=o[0]-i[0],t.moveX=o[0]-e[0],t.deltaY=o[1]-i[1],t.moveY=o[1]-e[1];const r=Date.now(),s=this._swipePoints||[[],[]];r-((s[1][0]?s[1][0].timestamp:0)||0)>this.swipeDuration&&(s[0]=s[1],s[1]=[]),s[1].push({point:o,timestamp:r}),this._swipePoints=s,this.emit("pan",t)}}this.emit("pointerMove",t)}}function v(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]};let i=null,n=null;this._pointer0&&(this._pointer0.changed=!1),this._pointer1&&(this._pointer1.changed=!1);const{points:o}=l(e);for(let e=0,t=o.length;t>e;++e){const t=o[e];this._pointer0&&this._pointer0.identifier===t.identifier?(this._pointer0.changed=!0,i=this._pointer0,this._pointer0=null):this._pointer1&&this._pointer1.identifier===t.identifier&&(this._pointer1.changed=!0,n=this._pointer1,this._pointer1=null)}if(this._pointer1&&!this._pointer0&&(this._pointer0=this._pointer1,this._pointer1=null,n=i,i=null),this._longTapTimer&&(clearTimeout(this._longTapTimer),this._longTapTimer=0),this._pointer0){t.pointers=[this._pointer0],this._pointer1?t.pointers.push(this._pointer1):n&&(t.leavePointers=[n],this._rotateAngle=0);const e=c(this._pointer0.start,this._pointer1?this._pointer1.start:n?n.start:[]),i=c(this._pointer0.previous,this._pointer1?this._pointer1.previous:n?n.previous:[]),o=c(this._pointer0.current,this._pointer1?this._pointer1.current:n?n.current:[]);t.getPoint=t=>"start"===t?e:"previous"===t?i:o,this.emit("gestureEnd",t)}else if(i){t.leavePointers=[i],n&&t.leavePointers.push(n);const e=n?c(i.start,n.start):i.start,o=n?c(i.previous,n.previous):i.previous,p=n?c(i.current,n.current):i.current;if(t.getPoint=t=>"start"===t?e:"previous"===t?o:p,this._preventTap||(this.emit("tap",t),this._preventTap=!0),this._preventSingleTap||(this._singleTapTimer=+setTimeout((()=>{this._singleTapTimer=0,t.delayTime=this.doubleTapInterval,this.emit("singleTap",t)}),this.doubleTapInterval),this._preventSingleTap=!0),!this._preventDoubleTap){const e=this._firstPointer;e&&(t.getPoint=()=>e.current),t.intervalTime=this.doubleTapInterval,this.emit("doubleTap",t),this._firstPointer=null,this._preventDoubleTap=!0}if(this._swipePoints){const[e,i]=this._swipePoints,n=i[i.length-1];if(Date.now()-n.timestamp<=this.raiseDuration){let o=i[0];for(let t=e.length-1;t>=0&&n.timestamp-e[t].timestamp<=this.swipeDuration;t--)o=e[t];const p=(r=n.timestamp-o.timestamp,"number"!=typeof(s=h(o.point,n.point))||0===s||"number"!=typeof r||0===r?0:s/r);if(p>this.swipeVelocity){const e=u(o.point,n.point);t.direction=m(o.point,n.point),t.angle=e,t.velocity=p,t.swipeComputed=(t,i=p)=>{let n=0,o=0,r=0;t>1?(n=t,o=i/n,r=i*n/2):t>0&&(o=t,n=i/o,r=i*i/(2*o));const[s,a]=function(e,t){if("number"!=typeof e||"number"!=typeof t)return[0,0];const i=t*Math.PI/180;return[e*Math.cos(i),e*Math.sin(i)]}(r,e);return{duration:n,stretchX:s,stretchY:a,deceleration:o}},this.emit("swipe",t),this._swipePoints=null}}}}var r,s;this.emit("pointerEnd",t)}function g(e){this.emit("pointerCancel",{sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]}),v.call(this,e)}function T(e){const t=this;function i(){"undefined"!=typeof window&&(window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s),window.removeEventListener("blur",n),window.removeEventListener("dragstart",o),"onselectstart"in window.document.documentElement&&window.removeEventListener("selectstart",o))}function n(e){e.preventDefault(),e.stopPropagation(),i()}function o(e){e.preventDefault(),e.stopPropagation()}function r(i){if(0===e.button)_.call(t,i);else{const n={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},o=[i.pageX,i.pageY];if(t._pointer0){t._pointer0.previous=t._pointer0.current,t._pointer0.current=o,n.pointers=[t._pointer0];const{start:e,previous:i,current:r}=t._pointer0;n.getPoint=t=>"start"===t?e:"previous"===t?i:r,n.direction=m(i,r),n.moveDirection=m(e,r),n.deltaX=r[0]-i[0],n.moveX=r[0]-e[0],n.deltaY=r[1]-i[1],n.moveY=r[1]-e[1],n.angle=n.deltaX/4,n.moveAngle=n.moveX/4,t.emit("rotate",n)}}}function s(n){if(i(),0===e.button)v.call(t,n);else{const i={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},o=[n.pageX,n.pageY];if(t._pointer0){const e=t._pointer0;t._pointer0=null,e.previous=e.current,e.current=o,i.leavePointers=[e];const{start:n,previous:r,current:s}=e;i.getPoint=e=>"start"===e?n:"previous"===e?r:s}i.angle=NaN,t.emit("rotate",i)}}if("undefined"!=typeof window&&(window.addEventListener("mousemove",r),window.addEventListener("mouseup",s),window.addEventListener("blur",n),window.addEventListener("dragstart",o,{capture:!0,passive:!1}),"onselectstart"in window.document.documentElement&&window.addEventListener("selectstart",o,{capture:!0,passive:!1})),0===e.button)d.call(t,e);else{t._wheelTimerEnd&&(clearTimeout(t._wheelTimerEnd.timer),t._wheelTimerEnd.wheelEnd(),t._wheelTimerEnd=null);const i=[e.pageX,e.pageY];t._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0}}}function w(e){const t={sourceEvent:e,timestamp:Date.now(),pointers:[],leavePointers:[],getPoint:()=>[0,0]},i=[e.pageX,e.pageY];this._wheelTimerEnd?(this._pointer0&&(this._pointer0.previous=this._pointer0.current,this._pointer0.current=i),clearTimeout(this._wheelTimerEnd.timer)):this._pointer0={start:i,previous:i,current:i,identifier:-1,changed:!0};const n=()=>{this._pointer0=null,this._wheelTimerEnd=null,t.timestamp=Date.now(),t.scale=NaN,this.emit("scale",t)};if(this._wheelTimerEnd={wheelEnd:n,timer:+setTimeout(n,this.wheelDelay),scale:this._wheelTimerEnd?this._wheelTimerEnd.scale:1},this._pointer0){t.pointers=[this._pointer0];const{start:i,previous:n,current:o}=this._pointer0;t.getPoint=e=>"start"===e?i:"previous"===e?n:o;const r=Math.pow(2,-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002));this._wheelTimerEnd.scale*=r,t.moveScale=this._wheelTimerEnd.scale,t.scale=r,this.emit("scale",t)}}const b=["children","options","preventAllTap"];var P=e.forwardRef(((r,s)=>{let{children:p,options:l,preventAllTap:h}=r,u=function(e,t){if(null==e)return{};var i,n,o={},r=Object.keys(e);for(n=0;r.length>n;n++)0>t.indexOf(i=r[n])&&(o[i]=e[i]);return o}(r,b);const c=e.useRef(null),m=e.useRef(null);n((()=>{m.current=new f}),[]),n((()=>{m.current&&m.current.resetOptions(l)}),[l]),n((()=>{h&&m.current&&m.current.preventAllTap()}),[h]),function(e,t){const{onPan:i,onTap:n,onSwipe:r,onSingleTap:s,onLongTap:p,onDoubleTap:a,onMultiPan:l,onScale:h,onRotate:u,onPointerStart:c,onPointerMove:m,onPointerEnd:f,onPointerCancel:d,onGestureStart:_,onGestureMove:v,onGestureEnd:g}=e;o(t,"pan",i),o(t,"tap",n),o(t,"swipe",r),o(t,"singleTap",s),o(t,"longTap",p),o(t,"doubleTap",a),o(t,"multiPan",l),o(t,"scale",h),o(t,"rotate",u),o(t,"pointerStart",c),o(t,"pointerMove",m),o(t,"pointerEnd",f),o(t,"pointerCancel",d),o(t,"gestureStart",_),o(t,"gestureMove",v),o(t,"gestureEnd",g)}(u,e.useCallback((()=>m.current),[])),e.useImperativeHandle(s,(()=>({findDOMElement:()=>c.current,getInstance:()=>m.current})),[]);const P=e.useCallback((i=>{let n=i;!(i instanceof Element)&&i instanceof e.Component&&(n=t.findDOMNode(i)),n instanceof Element||(n=null),c.current=n}),[]),E=(e,t)=>{const i=m.current;i&&e.apply(i,t)};return p?e.Children.only(e.cloneElement(p,i({ref:P},a()?{onTouchStart:(...e)=>E(d,e),onTouchMove:(...e)=>E(_,e),onTouchEnd:(...e)=>E(v,e),onTouchCancel:(...e)=>E(g,e)}:{onMouseDown:(...e)=>E(T,e),onWheel:(...e)=>E(w,e)}))):(console.warn("Warning: Gesture children must exist."),null)}));export{P as default,a as isTouchable};
//# sourceMappingURL=react-gesture.min.js.map
